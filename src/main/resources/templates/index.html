<!DOCTYPE html>
<html lang="en">

<head>
    <title>DMN Service</title>
    <link rel="shortcut icon" href="https://www.efundzz.com/favicon.ico">
    <script>
		//Giving validations to input variables
		document.addEventListener('DOMContentLoaded', function () {
			document.getElementById('takeHomeSalaryMonthly').addEventListener('input', function () {
				this.value = this.value.replace(/\D/g, ''); // Remove non-digit characters
				if (this.value.length > 7) {
					this.value = this.value.slice(0, 7); // Limit input to 7 digits
				}
			});

			document.getElementById('experienceYears').addEventListener('input', function () {
				this.value = this.value.replace(/\D/g, ''); // Remove non-digit characters
				if (this.value > 40) {
					this.value = '40'; // Limit experience years to 40
				}
			});

			document.getElementById('experienceMonths').addEventListener('input', function () {
				this.value = this.value.replace(/\D/g, ''); // Remove non-digit characters
				if (this.value > 11) {
					this.value = '11'; // Limit experience months to 11
				}
			});

			document.getElementById('loanAmount').addEventListener('input', function () {
				this.value = this.value.replace(/\D/g, ''); // Remove non-digit characters
				if (this.value.length > 7) {
					this.value = this.value.slice(0, 7); // Limit input to 7 digits
				}
			});

			document.getElementById('foir').addEventListener('input', function () {
				this.value = this.value.replace(/\D/g, ''); // Remove non-digit characters
				if (this.value.length > 2) {
					this.value = this.value.slice(0, 2); // Limit input to 2 digits
				}
			});
			//Restricting the user not to give date of birth greater than current date
			document.getElementById('dateOfBirth').max = formatDateInput(new Date());
			document.getElementById('dateOfBirth').addEventListener('change', function () {
				const selectedDate = new Date(this.value);
				const currentDate = new Date();
				if (selectedDate > currentDate) {
					alert("Please select a date not in the future.");
					this.value = '';
				}
			});
			//restricting the user not give year more than current year
			document.getElementById('dateOfBirth').addEventListener('input', function () {
				const currentYear = new Date().getFullYear();
				const inputYear = new Date(this.value).getFullYear();
				if (inputYear > currentYear) {
					this.value = currentYear + this.value.slice(4);
				}
			});

		});

		async function evaluateDecision() {
			document.getElementById('decisionResult').innerText = '';
			// Checking for any required fields are empty
			const requiredFields = ['creditScore', 'takeHomeSalaryMonthly', 'dateOfBirth', 'experienceYears', 'experienceMonths', 'residentType', 'loanAmount', 'foir'];
			let allFieldsFilled = true;

			for (const field of requiredFields) {
				const fieldValue = document.getElementById(field).value;
				if (!fieldValue) {
					allFieldsFilled = false;
					break;
				}
			}

			if (!allFieldsFilled) {
				alert("Please fill in all required fields.");
				return;
			}
			const inputVariables = {
				creditScore: document.getElementById('creditScore').value,
				takeHomeSalaryMonthly: document.getElementById('takeHomeSalaryMonthly').value,
				dateOfBirth: formatDateInput(document.getElementById('dateOfBirth').value),
				experienceYears: document.getElementById('experienceYears').value,
				experienceMonths: document.getElementById('experienceMonths').value,
				residentType: document.getElementById('residentType').value,
				loanAmount: document.getElementById('loanAmount').value,
				foir: document.getElementById('foir').value
			};

			const response = await fetch('/evaluate', {
				method: 'POST',
				headers: {
					'Content-Type': 'application/json'
				},
				body: JSON.stringify(inputVariables)
			});

			if (response.status === 200) {
				const banks = await response.json(); // Assuming the response is an array of banks
				const bankContainer = document.getElementById('decisionResult');
				banks.forEach((bank) => {
					const bankDiv = document.createElement('div');
					bankDiv.className = 'bank-name'; // Apply any desired CSS classes
					// Set the content of the bank div
					bankDiv.innerText = bank; // Modify this line to format the bank information as needed
					bankContainer.appendChild(bankDiv); // Append the bank div to the container
				});
			}else if(response.status === 204){
				alert("According to our BRE no Bank is providing loan for your provided data");
			}
			else if (response.status === 400) {
				// Validation error case: handle error response
				try {
					const errorData = await response.json();
					displayValidationErrors(errorData);
				} catch (error) {
					alert("An error occured while processing your request");
				}
			} else {
				alert("'Currently we are unable to provide the eligible banks for the internal server issue.");
			}
		}
		function displayValidationErrors(errorData) {
			let errorMessage = "According to our BRE:\n";
			for (const field in errorData) {
				if (errorData.hasOwnProperty(field)) {
					errorMessage += `${field}: ${errorData[field]}\n`;
				}
			}
			alert(errorMessage);
		}
		//converting the date of birth format to yyyy-MM-dd as required to send it to the backend
		function formatDateInput(inputDate) {
			const date = new Date(inputDate);
			const year = date.getFullYear();
			const month = (date.getMonth() + 1).toString().padStart(2, '0');
			const day = date.getDate().toString().padStart(2, '0');
			return `${year}-${month}-${day}`;
		}
	</script>
    <style>
		body {
			font-family: Arial, sans-serif;
			background-color: rgb(255, 245, 238);
			margin: 0px;
			padding: 30px 0px;
		}

		.wrp {
			padding: 0px;
			margin: 0px;
		}

		.container {
			width: 600px;
			height: 750px;
			margin: 0px auto;
			padding: 20px;
			background-color: #fff;
			border: 1px solid rgb(255, 128, 0);
			border-radius: 6px;
		}

		h1 {
			color: rgb(255, 128, 0);
			text-align: center;
			margin-bottom: 20px;
		}

		.form-div {
			padding: 6px;
			margin: 0px;

		}

		.form-left {
			padding: 6px;
			float: left;
			width: 46%;
		}

		.form-right {
			padding: 6px;
			float: left;
			width: 46%;
		}

		.cls {
			clear: both
		}

		.button {
			background: rgb(255, 128, 0);
			padding: 8px;
			border-radius: 6px;
			border: 1px solid red;
			color: #fff;
		}

		.bank-name {
			float: left;
			padding: 6px;
			margin: 8px;
			background-color: rgb(255, 245, 238);
			border: 1px solid red;
			border-radius: 5px;

		}
	</style>
</head>

<body>
<div class="container">
    <h1>PL BRE Utility</h1>
    <form>
        <div class="form-div">
            <div class="form-left">
                Select your Credit Grade:
            </div>
            <div class="form-right">
                <select id="creditScore">
                    <option value="">Select</option>
                    <option value="A+">A+</option>
                    <option value="A">A</option>
                    <option value="B">B</option>
                    <option value="C">C</option>
                    <option value="D">D</option>
                    <option value="E">E</option>
                    <option value="F">F</option>
                    <option value="G">G</option>
                    <option value="NH">NH</option>
                </select>
            </div>
            <div class="cls"></div>
        </div>
        <div class="form-div">
            <div class="form-left">
                Monthly Salary:
            </div>
            <div class="form-right">
                <input type="text" id="takeHomeSalaryMonthly">
            </div>
            <div class="cls"></div>
        </div>
        <div class="form-div">
            <div class="form-left">
                Date Of Birth:
            </div>
            <div class="form-right">
                <input type="date" id="dateOfBirth" max="" />
            </div>
            <div class="cls"></div>
        </div>
        <div class="form-div">
            <div class="form-left">
                Experience Years:
            </div>
            <div class="form-right">
                <input type="text" id="experienceYears" placeholder="years">
            </div>
            <div class="cls"></div>
        </div>
        <div class="form-div">
            <div class="form-left">
                Months:
            </div>
            <div class="form-right">
                <input type="text" id="experienceMonths" placeholder="months">
            </div>
            <div class="cls"></div>
        </div>
        <div class="form-div">
            <div class="form-left">
                Residency Type:
            </div>
            <div class="form-right">
                <select id="residentType">
                    <option value="">Select</option>
                    <option value="Owned">Owned</option>
                    <option value="Rented">Rented</option>
                    <option value="PG or Staying with Friends">PG or Staying with Friends</option>
                    <option value="Company Accommodation">Company Accommodation</option>
                    <option value="Others">Others</option>
                </select>
            </div>
            <div class="cls"></div>
        </div>
        <div class="form-div">
            <div class="form-left">
                Loan Amount:
            </div>
            <div class="form-right">
                <input type="text" id="loanAmount">
            </div>
            <div class="cls"></div>
        </div>
        <div class="form-div">
            <div class="form-left">
                FOIR:
            </div>
            <div class="form-right">
                <input type="text" id="foir">
            </div>
            <div class="cls"></div>
        </div>
    </form>
    <br>
    <button class="button" onclick="evaluateDecision()">Submit</button>
    <br><br>
    <h2>Eligible Banks:</h2>
    <p id="decisionResult"></p>

</div>
</body>

</html>